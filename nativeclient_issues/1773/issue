<ns0:entry xmlns:ns0="http://www.w3.org/2005/Atom" xmlns:ns1="http://schemas.google.com/g/2005" xmlns:ns2="http://schemas.google.com/projecthosting/issues/2009" ns1:etag="W/&quot;CE4DQn47eCl7ImA9WhVTEU0.&quot;">
		<ns0:id>http://code.google.com/feeds/issues/p/nativeclient/issues/full/1773</ns0:id><ns0:author>
			<ns0:name>k...@google.com</ns0:name><ns0:uri>/u/112873510090665368075/</ns0:uri></ns0:author><ns0:content type="html">Currently SCONS uses single command to build library. For example the command which builds libppruntime.a looks like this:

C:\b\build\slave\win7-glibc\build\native_client\tools\toolchain\win_x86\bin\nacl64-ar rc tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\libppruntime.a tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer_nacl.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\object.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\object_proxy.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\object_serialize.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\objectstub_rpc_impl.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_callback.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_context_3d.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_globals.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_instance_data.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_main.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_nacl_file.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_opengles.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_audio.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_audio_config.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_buffer.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_core.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_cursor_control.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_file_io.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_file_system.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_file_ref.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_find.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_font.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_graphics_2d.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_image_data.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_instance.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_pdf.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_scrollbar.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_testing.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_url_loader.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_url_request_info.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_url_response_info.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_var.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_widget.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppb_zoom.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppp_find_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppp_instance_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppp_printing_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppp_scrollbar_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppp_selection_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppp_widget_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppp_zoom_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_ppp_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_resource.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_resource_tracker.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_surface_3d.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_threading.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\plugin_upcall.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\utility.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\ppp_rpc_server.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\ppb_rpc_client.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\upcall_client.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\common\cmd_buffer_common.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\common\gles2_cmd_format.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\common\gles2_cmd_utils.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\client\cmd_buffer_helper.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\client\fenced_allocator.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\client\gles2_c_lib.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\client\gles2_cmd_helper.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\client\gles2_implementation.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\client\gles2_lib.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\client\mapped_memory.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\client\ring_buffer.o tools\BUILD\nacl_extra_sdk-x86-32-glibc\obj\src\shared\ppapi_proxy\command_buffer\common\id_allocator.o

It works fine on Linux. But on Windows it may hit 8192 limit of CMD.EXE (cygwin allows command lines up to 31768 characters, but CMD.EXE limit is 8192). Possible solutions:
1. Build archive using few nacl-ar commands (may cause problems with shared libraries in the future).
2. Teach SCONS to call nacl-ar directly (but this will only raise limit 4x).
3. Move all scons-created object files in a single directory (nameclashes are not a problem since archive format does not allow them anyway).
4 Anything else?

We've already hit this problem on glibc bot and I've fixed it but adjusting command line slightly but it means command line is currently 6054 characters where the limit is 8192 characters so if we'll expand out libraries they'll hit the limit pretty soon.

P.S. I've assigned Pri-2 to the issue because we are safe for a week or two, but it may be elevated to Pri-0 quite suddenly if someone will add bunch of new files.</ns0:content><ns0:updated>2012-02-24T17:02:53.000Z</ns0:updated><ns0:published>2011-05-05T19:36:55.000Z</ns0:published><ns2:status>Assigned</ns2:status><ns2:owner>
			<ns2:uri>/u/108771824208521698652/</ns2:uri><ns2:username>robe...@google.com</ns2:username></ns2:owner><ns2:cc>
			<ns2:uri>/u/103360015124260446450/</ns2:uri><ns2:username>eaelt...@google.com</ns2:username></ns2:cc><ns2:cc>
			<ns2:uri>/u/101628056640429344673/</ns2:uri><ns2:username>pa...@google.com</ns2:username></ns2:cc><ns2:cc>
			<ns2:uri>/u/bradnelson@google.com/</ns2:uri><ns2:username>bradnelson@google.com</ns2:username></ns2:cc><ns2:state>open</ns2:state><ns0:title>scons can not build libraries incrementally</ns0:title><ns2:label>Type-Defect</ns2:label><ns2:label>Pri-2</ns2:label><ns2:label>Component-Infrastructure</ns2:label><ns2:label>OS-Windows</ns2:label><ns2:label>Arch-All</ns2:label><ns2:label>Mstone-X</ns2:label><ns0:link href="http://code.google.com/feeds/issues/p/nativeclient/issues/1773/comments/full" rel="replies" type="application/atom+xml" /><ns0:link href="http://code.google.com/p/nativeclient/issues/detail?id=1773" rel="alternate" type="text/html" /><ns0:link href="https://code.google.com/feeds/issues/p/nativeclient/issues/full/1773" rel="self" type="application/atom+xml" /><ns2:stars>1</ns2:stars><ns2:id>1773</ns2:id></ns0:entry>