<ns0:entry xmlns:ns0="http://www.w3.org/2005/Atom" xmlns:ns1="http://schemas.google.com/g/2005" xmlns:ns2="http://schemas.google.com/projecthosting/issues/2009" ns1:etag="W/&quot;CU4ARX47eCl7ImA9WhZXEU0.&quot;">
		<ns0:id>http://code.google.com/feeds/issues/p/nativeclient/issues/1595/comments/full/21</ns0:id><ns0:author>
			<ns0:name>bugdro...@chromium.org</ns0:name><ns0:uri>/u/101788990881243245974/</ns0:uri></ns0:author><ns0:content type="html">The following revision refers to this bug:
    http://src.chromium.org/viewvc/chrome?view=rev&amp;revision=5108

------------------------------------------------------------------------
r5108 | mcgrathr@chromium.org | Fri Apr 29 12:01:56 PDT 2011

Changed paths:
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/sysconf.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt/nacl.scons?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/pthread/nc_thread.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_thread_create.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/fstat.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/tls.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/_exit.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/dup.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 D http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt/irt.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/getdents.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt/irt.h?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/sched_yield.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/SConstruct?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_mutex_unlock.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_sem.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_sem_post.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_mutex_trylock.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 D http://src.chromium.org/viewvc/chrome/trunk/src/native_client/tests/irt_hw/nacl.scons?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/sbrk.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/open.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt_stub/plugin_main_irt.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/gc_hooks.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_basic.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_thread_nice.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_sem_wait.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_blockhook.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_thread_exit.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_file.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt_stub/thread_creator.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/stat.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/munmap.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_cond_create.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt_stub/thread_creator.h?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nanosleep.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_sem_create.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/lseek.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/dyncode.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_cond_broadcast.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_tls.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_thread.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_mutex.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_read_tp.c?r1=5108&amp;r2=5107&amp;pathrev=5108 (from /trunk/src/native_client/src/untrusted/nacl/nacl_tls_get.c revision 5106)
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt/irt_entry.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/close.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_tls_get.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_mutex_create.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_cond.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt/irt_interfaces.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt/irt_interfaces.h?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/clock.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_cond_signal.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_dyncode.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_irt.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_cond_timed_wait_abs.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 D http://src.chromium.org/viewvc/chrome/trunk/src/native_client/tests/irt_hw/irt_hw.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_tls_init.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_irt.h?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_cond_wait.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt/irt_ppapi.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/mmap.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/write.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/irt/irt_ppapi.h?r1=5108&amp;r2=5107&amp;pathrev=5108
 A http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/irt_memory.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/read.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/include/elf32.h?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl.scons?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/nacl_mutex_lock.c?r1=5108&amp;r2=5107&amp;pathrev=5108
 M http://src.chromium.org/viewvc/chrome/trunk/src/native_client/src/untrusted/nacl/gettimeofday.c?r1=5108&amp;r2=5107&amp;pathrev=5108

This defines what might be the stable IRT ABI in untrusted/irt/irt.h,
implements it in the IRT, and makes the newlib build use it for system
services.

This is still very much a transitional state, far from clean or final.
Right now, the same newlib/libnacl arrangement is used to build
irt.nexe itself, the miscellaneous private tests, and newlib-based
user applications.  For this to work, the newlib/libnacl code has to
work both with and without an IRT.  It does this by always using
indirection tables for the calls that should go through the IRT, but
falling back to supplying its own tables when there is no IRT present.
These are the same tables that are built into the IRT itself to
provide the official ABI entry points.

Later, we should split the library providing the system interface
calls via the IRT from the one providing private interfaces used
in tests and in the IRT itself.  Doing that requires cleaning up
the linking rules used by the buildsystem and toolchain.

The irt_hw test is removed because it no longer makes sense in the
context of true IRT loading.  All normal tests now constitute IRT
tests when scons it given the irt=1 parameter.

R=mseaborn@chromium.org,bradchen@google.com
BUG=http://code.google.com/p/nativeclient/issues/detail?id=1595
TEST=chrome_browser_tests irt=1 works;
     {small,medium,large}_tests irt=1 works as well as they did before;
     trybots

Review URL: http://codereview.chromium.org/6899028
------------------------------------------------------------------------</ns0:content><ns0:updated>2011-04-29T19:05:44.000Z</ns0:updated><ns0:published>2011-04-29T19:05:44.000Z</ns0:published><ns2:updates /><ns0:title>Comment 21 by bugdro...@chromium.org</ns0:title><ns0:link href="http://code.google.com/p/nativeclient/issues/detail?id=1595#c21" rel="alternate" type="text/html" /><ns0:link href="https://code.google.com/feeds/issues/p/nativeclient/issues/1595/comments/full/21" rel="self" type="application/atom+xml" /></ns0:entry>