<ns0:entry xmlns:ns0="http://www.w3.org/2005/Atom" xmlns:ns1="http://schemas.google.com/g/2005" xmlns:ns2="http://schemas.google.com/projecthosting/issues/2009" ns1:etag="W/&quot;AkUBRH47eCl7ImA9WhdXEEs.&quot;">
		<ns0:id>http://code.google.com/feeds/issues/p/nativeclient/issues/2160/comments/full/6</ns0:id><ns0:author>
			<ns0:name>robertm@google.com</ns0:name><ns0:uri>/u/robertm@google.com/</ns0:uri></ns0:author><ns0:content type="html">The problem is with the unwind information for certain frames.

In this case _Unwind_Resume_or_Rethrow


GOOD:


0000105c 0000002c 00000570 FDE cie=00000af0 pc=00043970..00043ac0
   DW_CFA_nop
   DW_CFA_advance_loc4: 4 to 00043974
   DW_CFA_def_cfa_offset: 28
   DW_CFA_offset: r14 at cfa-4
   DW_CFA_offset: r11 at cfa-8
   DW_CFA_offset: r8 at cfa-12
   DW_CFA_offset: r7 at cfa-16
   DW_CFA_offset: r6 at cfa-20
   DW_CFA_offset: r5 at cfa-24
   DW_CFA_offset: r4 at cfa-28
   DW_CFA_advance_loc4: 4 to 00043978
   DW_CFA_def_cfa: r11 ofs 8       &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
   DW_CFA_nop
   DW_CFA_nop



BAD:



 00000ea0 0000002c 00000ea4 FDE cie=00000000 pc=00043450..00043590
   DW_CFA_advance_loc: 4 to 00043454
   DW_CFA_def_cfa_offset: 28
   DW_CFA_offset: r14 at cfa-4
   DW_CFA_offset: r11 at cfa-8
   DW_CFA_offset: r8 at cfa-12
   DW_CFA_offset: r7 at cfa-16
   DW_CFA_offset: r6 at cfa-20
   DW_CFA_offset: r5 at cfa-24
   DW_CFA_offset: r4 at cfa-28
   DW_CFA_advance_loc: 4 to 00043458
   DW_CFA_def_cfa: r11 ofs -8
   DW_CFA_nop


The  DW_CFA_def_cfa entry is generated by 
lib/MC/MCDwarf.cpp::mitCFIInstruction()

There used to be only case "MCCFIInstruction::Move" but now there is another one:
MCCFIInstruction::RelMove

I do not fully understand the difference between the two.
I was actually surprised that the code in 
ARMFrameLowering::emitPrologue still carries our LOCALMODs.
I expected them to be replaced as part of the upstream ARM EH revamp but maybe that has not happened yet.

Given my limited understanding I believe the right fix is:
in  ARMFrameLowering::emitPrologue
   MachineLocation src(FramePtr, -8);  -&gt; achineLocation src(FramePtr, 8);


At least that makes the remaining tests work again. 













</ns0:content><ns0:updated>2011-08-23T02:57:35.000Z</ns0:updated><ns0:published>2011-08-23T02:57:35.000Z</ns0:published><ns2:updates /><ns0:title>Comment 6 by robertm@google.com</ns0:title><ns0:link href="http://code.google.com/p/nativeclient/issues/detail?id=2160#c6" rel="alternate" type="text/html" /><ns0:link href="https://code.google.com/feeds/issues/p/nativeclient/issues/2160/comments/full/6" rel="self" type="application/atom+xml" /></ns0:entry>