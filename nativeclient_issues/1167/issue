<ns0:entry xmlns:ns0="http://www.w3.org/2005/Atom" xmlns:ns1="http://schemas.google.com/g/2005" xmlns:ns2="http://schemas.google.com/projecthosting/issues/2009" ns1:etag="W/&quot;Dk4NSH47eCl7ImA9Wx5aFkk.&quot;">
		<ns0:id>http://code.google.com/feeds/issues/p/nativeclient/issues/full/1167</ns0:id><ns0:author>
			<ns0:name>aba...@chromium.org</ns0:name><ns0:uri>/u/117420925389613150407/</ns0:uri></ns0:author><ns0:content type="html">What version of the SDK are you using? Top-of-tree (Nov 12, 2010)
What version of the runtime are you using? Top-of-tree (Nov 12, 2010)
On what operating system? Mac OS X (Snow Leopard)
What browser are you using? N/A
&lt;b&gt;Please include version information for both the OS and the browser.&lt;/b&gt;

&lt;b&gt;What steps will reproduce the problem?&lt;/b&gt;
1. Build the Chromium IPC library using the toolchain.
2. Run the resulting executable using sel_ldr.

What is the expected output?

The nexe passes validation and executes.

What do you see instead?

The nexe fails to execute because it fails validation.

&lt;b&gt;Please provide any additional information below and attach any relevant&lt;/b&gt;
&lt;b&gt;source files.&lt;/b&gt;

I'll try to create a reduced test case, but until then, here's the output from the tools:

$ ~/svn/nacl/native_client/scons-out/opt-mac-x86-32/obj/src/trusted/service_runtime/sel_ldr hello_world_x86_32.nexe 
[26404,2684474624:19:53:03.964684] VALIDATION FAILED.
[26404,2684474624:19:53:03.964860] Run sel_ldr in debug mode to ignore validation failure.
[26404,2684474624:19:53:03.964869] Run ncval &amp;lt;module-name&amp;gt; for validation error details.
Error while loading &amp;quot;hello_world_x86_32.nexe&amp;quot;: Validation failure. File violates Native Client safety rules.
Using the wrong type of nexe (nacl-x86-32 on an x86-64 or vice versa)
or a corrupt nexe file may be responsible for this error.

$ ~/svn/nacl/native_client/scons-out/opt-mac-x86-32/obj/src/trusted/validator_x86/ncval hello_world_x86_32.nexe 
D: segment[0] p_type 6 p_offset 0 vaddr 0 paddr 0 align 4
D:     filesz b4 memsz b4 flags 4
D: segment[1] p_type 1 p_offset 10000 vaddr 20000 paddr 20000 align 65536
D:     filesz 187280 memsz 187280 flags 5
D: parsing segment 1
VALIDATOR: bafa3: Illegal instruction
D: segment[2] p_type 1 p_offset 1a0000 vaddr 1b0000 paddr 1b0000 align 65536
D:     filesz 404bc memsz 404bc flags 4
D: segment[3] p_type 1 p_offset 1f0000 vaddr 200000 paddr 200000 align 65536
D:     filesz c40 memsz 9220 flags 6
D: ***MODULE hello_world_x86_32.nexe IS UNSAFE***

Opcode Histogram;
985	0x01	2	0x02	622	0x03	48	0x05	
24	0x08	256	0x09	70	0x0b	2	0x0c	
14	0x0d	15585	0x0f	35	0x11	7	0x13	
79	0x19	20	0x1b	10	0x20	55	0x21	
18	0x23	83	0x25	76	0x28	1149	0x29	
433	0x2b	20	0x2d	12	0x30	2324	0x31	
11	0x33	1	0x35	242	0x38	2756	0x39	
85	0x3a	1379	0x3b	281	0x3c	538	0x3d	
1	0x40	1	0x46	25	0x47	11	0x49	
1	0x4a	2	0x4e	2	0x4f	3	0x50	
4	0x51	1	0x52	1733	0x53	4018	0x55	
906	0x56	757	0x57	3969	0x59	481	0x5a	
2175	0x5b	4777	0x5d	1311	0x5e	1119	0x5f	
2	0x68	59	0x69	80	0x6b	188	0x72	
231	0x73	4361	0x74	1838	0x75	279	0x76	
436	0x77	249	0x78	54	0x79	18	0x7a	
41	0x7c	26	0x7d	395	0x7e	263	0x7f	
1638	0x80	1313	0x81	21310	0x83	1252	0x84	
6297	0x85	2	0x87	835	0x88	53509	0x89	
12	0x8a	39220	0x8b	30552	0x8d	581734	0x90	
7	0x98	261	0xa1	6	0xa2	52	0xa3	
6	0xa4	11	0xa5	156	0xa6	1	0xa7	
62	0xa8	22	0xa9	1	0xaa	20	0xab	
18	0xb0	13	0xb1	7	0xb2	4	0xb3	
9	0xb4	1	0xb5	6	0xb6	1224	0xb8	
455	0xb9	1048	0xba	436	0xbb	203	0xbe	
271	0xbf	1143	0xc1	2015	0xc6	13834	0xc7	
9	0xc9	1	0xcc	115	0xd1	173	0xd3	
50	0xd8	301	0xd9	80	0xdb	66	0xdc	
606	0xdd	35	0xde	77	0xdf	15574	0xe8	
7716	0xe9	28171	0xeb	51	0xf4	556	0xf6	
508	0xf7	5	0xfc	1	0xfd	5431	0xff	
Analysis Summary:
875531 Checked instructions
110558 checked jump targets
5431 calls/jumps need dynamic checking (0.62%)

Problems:
1 illegal instructions
0 bad jump targets
0 illegal unprotected indirect jumps (including ret)
0 instruction alignment defects
0 segmentation errors
0 bad prefix
0 bad instruction length
0 internal errors
0 bad cpu
D: Validated hello_world_x86_32.nexe





</ns0:content><ns0:updated>2010-11-13T10:43:19.000Z</ns0:updated><ns0:published>2010-11-13T03:55:32.000Z</ns0:published><ns2:status>Duplicate</ns2:status><ns2:cc>
			<ns2:uri>/u/101644972956654258238/</ns2:uri><ns2:username>esei...@chromium.org</ns2:username></ns2:cc><ns2:cc>
			<ns2:uri>/u/cbiffle@google.com/</ns2:uri><ns2:username>cbiffle@google.com</ns2:username></ns2:cc><ns2:cc>
			<ns2:uri>/u/105821748722532785568/</ns2:uri><ns2:username>b...@google.com</ns2:username></ns2:cc><ns2:cc>
			<ns2:uri>/u/113000403807150741221/</ns2:uri><ns2:username>noelal...@google.com</ns2:username></ns2:cc><ns2:state>closed</ns2:state><ns0:title>VALIDATOR: bafa3: Illegal instruction generated by nacl-g++</ns0:title><ns2:label>Type-Defect</ns2:label><ns2:label>Pri-2</ns2:label><ns2:label>Arch-x86-64</ns2:label><ns2:label>OS-All</ns2:label><ns2:label>Arch-x86-32</ns2:label><ns2:label>ChromiumIPCBringup</ns2:label><ns0:link href="http://code.google.com/feeds/issues/p/nativeclient/issues/1167/comments/full" rel="replies" type="application/atom+xml" /><ns0:link href="http://code.google.com/p/nativeclient/issues/detail?id=1167" rel="alternate" type="text/html" /><ns0:link href="https://code.google.com/feeds/issues/p/nativeclient/issues/full/1167" rel="self" type="application/atom+xml" /><ns2:stars>1</ns2:stars><ns2:closedDate>2010-11-13T10:43:19.000Z</ns2:closedDate><ns2:id>1167</ns2:id><ns2:mergedInto>
			<ns2:id>645</ns2:id></ns2:mergedInto></ns0:entry>