<ns0:entry xmlns:ns0="http://www.w3.org/2005/Atom" xmlns:ns1="http://schemas.google.com/g/2005" xmlns:ns2="http://schemas.google.com/projecthosting/issues/2009" ns1:etag="W/&quot;A0ECRH47eCl7ImA9WhBaEkk.&quot;">
		<ns0:id>http://code.google.com/feeds/issues/p/nativeclient/issues/full/3436</ns0:id><ns0:author>
			<ns0:name>b...@google.com</ns0:name><ns0:uri>/u/105821748722532785568/</ns0:uri></ns0:author><ns0:content type="html">https://codereview.chromium.org/11262031 introduced the following race, trying to have command channel closure report a synthetic SIG_KILL exit status to the plugin.  The change not only reported the exit status, but also removed the &amp;quot;NaClExit(0);&amp;quot; call, letting the exit status processing code path take care of exiting.  That code path assumed that it was triggered by an untrusted thread invoking the exit syscall, and by relying on it we introduced the following race:

- The plugin provides the NaCl module and tells the service runtime to start the module.  Because the RPC handler simply wakes up the main thread which launches the NaCl module's main thread, there is a short timing window after the RPC handler has returned and the NaCl module's main thread can start running.
- Before the NaCl module's main thread starts (and various state flags set), the command channel closure occurs due to a hyperfast reload (very quick fingers clicking on a NaCl-module launching link can accomplish this).
- Because the normal exit handling code path is used in lieu of the fast exit, and that code path, due to its assumption that it is called for exit-syscall processing and thus at least one untrusted NaCl module thread is running, will fail to signal the main thread to exit.</ns0:content><ns0:updated>2013-05-22T19:07:45.000Z</ns0:updated><ns0:published>2013-05-16T19:55:44.000Z</ns0:published><ns2:status>Fixed</ns2:status><ns2:owner>
			<ns2:uri>/u/105821748722532785568/</ns2:uri><ns2:username>b...@google.com</ns2:username></ns2:owner><ns2:cc>
			<ns2:uri>/u/118309011164612460950/</ns2:uri><ns2:username>nfulla...@google.com</ns2:username></ns2:cc><ns2:cc>
			<ns2:uri>/u/112856509894568708731/</ns2:uri><ns2:username>halya...@google.com</ns2:username></ns2:cc><ns2:state>closed</ns2:state><ns0:title>Deadlock due to command channel closure race condition</ns0:title><ns2:label>Type-Defect</ns2:label><ns2:label>Mstone-29</ns2:label><ns2:label>Pri-2</ns2:label><ns2:label>Component-TCB</ns2:label><ns2:label>OS-All</ns2:label><ns2:label>Arch-All</ns2:label><ns0:link href="http://code.google.com/feeds/issues/p/nativeclient/issues/3436/comments/full" rel="replies" type="application/atom+xml" /><ns0:link href="http://code.google.com/p/nativeclient/issues/detail?id=3436" rel="alternate" type="text/html" /><ns0:link href="https://code.google.com/feeds/issues/p/nativeclient/issues/full/3436" rel="self" type="application/atom+xml" /><ns2:stars>1</ns2:stars><ns2:closedDate>2013-05-16T20:42:20.000Z</ns2:closedDate><ns2:id>3436</ns2:id></ns0:entry>